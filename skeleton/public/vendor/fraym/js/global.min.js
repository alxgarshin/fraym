const showTimeMode=!1;let startTime=(new Date).getTime(),jwtToken,jwtTokenRefreshing=null;const jwtTokenRefreshUrl=`${absolutePath()}/login/action=refresh_token`;let LOCALE={};const isInStandalone=!0===window.navigator.standalone||window.matchMedia("(display-mode: standalone)").matches,visibilityChangeHidden=void 0!==document.hidden?"hidden":void 0!==document.msHidden?"msHidden":void 0!==document.webkitHidden?"webkitHidden":"";let doDropfieldRefresh=!0,doSubmit=!1,blockDefaultSubmit=!1,popStateChanging=!1,currentHref=document.location.href,hrefAfterModalClose=null;const filesDirProtectRegexp=document.location.protocol+"//"+document.location.hostname+"/uploads/",filesDirProtect=new RegExp(filesDirProtectRegexp,"i"),dataLoaded={css:{},js:{},libraries:{},functions:{}},fraymElementsMap=new Map;let globalFraymListenersObserver;const activeListeners=new Map,actionRequestCallbacks={success:{},error:{}},actionRequestSupressErrorForActions=[],wysiwygObjs=new Map,filepondObjs=new Map,preloadedImages=[];let notyDialog=null;const _debounceTimers={};window.messages=defaultFor(window.messages,[]);let dynamicFieldsList=[],currentDynamicFieldsList=[],touchingDevice=!1,touchstartX=0,touchendX=0,touchstartY=0,touchendY=0,swipeTimeDiff=0,swipeTimeThreshold=200,swipeDiffThreshold=130;async function fraymInit(withDocumentEvents,updateHash){startTime=(new Date).getTime();for(const[key,value]of fraymElementsMap.entries())if(key!==document&&key!==window){let hasActiveElement=!1;_each(value.DOMElements,(element=>{element&&document.body.contains(element)&&(hasActiveElement=!0)})),hasActiveElement||value.destroy()}for(const[key,value]of filepondObjs.entries())el(`input[type="hidden"][name="${key}"]`)||filepondObjs.delete(key);for(const[key,value]of wysiwygObjs.entries())el(`div.wysiwyg-editor[name="${key}"]`)||wysiwygObjs.delete(key);if(updateHash=defaultFor(updateHash,!1),doDropfieldRefresh=!0,doSubmit=!1,fixateIndexerButtons(),showExecutionTime("fraymInit prepare"),_("input.inputfile[type=file]").each((function(){fraymFileUploadApply(this)})),_('input[type="text"], input[type="password"], textarea').each((function(){_(this).is("[placehold]")&&fraymPlaceholder(this)})),(el(".dpkr")||el(".dpkr_time"))&&fraymDateTimePickerApply(),showExecutionTime("Timepickers, files, placeholders"),_(".wysiwyg-editor").each((function(){fraymWysiwygApply(this)})),showExecutionTime("WYSIWYG"),_(".fraymtabs").each((function(){fraymTabsApply(this)})),showExecutionTime("Tabs"),withDocumentEvents){fraymNotyInit(),_(document.body).observerDOMChange((()=>{_("[title]",{noCache:!0}).each((function(){const self=_(this,{noCache:!0}),title=self.attr("title");title&&self.attr("data-tooltip-text",title),self.attr("title",null).destroy()})).destroy()})),_(document).on("click","button",(function(e){e.preventDefault()})),_(document).on("click","button.add_group",(function(e){e.stopImmediatePropagation();const self=_(this),elements=[];let sibling=self.prev("h1.data_h1").asDomElement().nextElementSibling;for(;sibling&&sibling!==self.asDomElement();)sibling.matches('div.field[id$="[0]"]')&&elements.push(sibling),sibling=sibling.nextElementSibling;const previousId=self.prev().attr("id").match(/\[([^\]]+)]$/);if(previousId){const newIdNumber=+previousId[1]+1;self.insert('<div class="field_group_separator"></div>',"before"),_each(elements,(element=>{const self2=element.cloneNode(!0);self2.id=self2.id.replace(/\[0]$/,`[${newIdNumber}]`);const inputs=elAll('[id$="[0]"], [name$="[0]"], [id*="[0]["], [name*="[0]["], [for*="[0]["]',self2);_each(inputs,(input=>{if(input.id&&(input.id.match(/]\[0]\[[^\]]+\]$/)?input.id=input.id.replace(/]\[0](\[[^\]]+])$/,`][${newIdNumber}]$1`):input.id.match(/\[0]$/)&&(input.id=input.id.replace(/\[0]$/,`[${newIdNumber}]`))),input.name&&(input.name.match(/]\[0]\[[^\]]+\]$/)?input.name=input.name.replace(/]\[0](\[[^\]]+])$/,`][${newIdNumber}]$1`):input.name.match(/\[0]$/)&&(input.name=input.name.replace(/\[0]$/,`[${newIdNumber}]`))),input.getAttribute("for")){let forValue=input.getAttribute("for");forValue.match(/]\[0]\[[^\]]+\]$/)?input.setAttribute("for",forValue.replace(/]\[0](\[[^\]]+])$/,`][${newIdNumber}]$1`)):forValue.match(/\[0]$/)&&input.setAttribute("for",forValue.replace(/\[0]$/,`[${newIdNumber}]`))}if(input.checked?input.removeAttribute("checked"):"TEXTAREA"==input.tagName?input.textContent="":input.getAttribute("value")&&input.removeAttribute("value"),input.classList.contains("dropfield")){_(input).empty();const div=document.createElement("div");div.textContent=LOCALE.dropFieldChoose,input.appendChild(div)}if(input.classList.contains("helper")){const newTarget=input.getAttribute("target").replace(/1/,newIdNumber+1),select=input.nextElementSibling;input.setAttribute("target",newTarget),input.removeAttribute("value"),select&&"SELECT"==select.tagName&&(select.id=newTarget,select.removeAttribute("value"))}})),self.insert(self2.outerHTML,"before")}));let tabindex=1;_("[tabindex]").each((function(){this.setAttribute("tabindex",tabindex),tabindex++}))}})),_(document).on("click",".dropfield div.options a",(function(e){e.stopImmediatePropagation();const checkbox=el(`[id="${_(this).attr("rel")}"]`);checkbox.checked=!checkbox.checked,_(checkbox).trigger("change")})),_(document).on("change",".dropfield2 .inputcheckbox, .dropfield2 .inputradio",(function(){if(doDropfieldRefresh){const container=_(this).closest(".dropfield2"),searchInput=container.find(".dropfield2_search > input");container.prev(".dropfield").trigger("refresh"),searchInput?.asDomElement()&&filterDropfield(searchInput,searchInput.val())}})),_(document).on("refresh",".dropfield",(function(){const df=_(this),df2=df.next(".dropfield2");let type="checkbox";el(".inputradio",df2.asDomElement())&&(type="radio");let hasSome=!1;df.empty(),df2.find("checkbox"===type?".inputcheckbox":".inputradio").each((function(){const self=_(this),text=self.next("label")?.asDomElement().innerHTML;self.is(":checked")&&(hasSome=!0,"checkbox"===type&&el(`a[rel="${self.attr("id")}"]`,df.asDomElement())||df.insert(`<div class="options">${text}<a rel="${self.attr("id")}"></a></div>`,"end"))})),hasSome||df.insert(`<div>${LOCALE.dropFieldChoose}</div>`,"end"),"radio"===type&&df2.is(":visible")&&df.click()})),_(document).on("keyup change",".dropfield2_search input",(function(){const self=_(this);debounce("filterDropfield",filterDropfield(self,self.val()),200)})),_(document).on("click",".dropfield2_search a.create",(function(e){e.stopImmediatePropagation();const self=_(this),name=self.next("input").val();if(name){const dropfield2=self.closest(".dropfield2"),id=dropfield2.attr("id").substring(7),count=dropfield2.is("[new_count]")?parseInt(dropfield2.attr("new_count"))+1:0;dropfield2.attr("new_count",count);const field=elNew("div",{classList:"dropfield2_field"}),checkbox=elNew("input",{type:"checkbox",name:`${id}[new][${count}]`,id:`${id}[new][${count}]`,classList:"inputcheckbox"}),label=elNew("label",{textContent:name});label.setAttribute("for",`${id}[new][${count}]`);const hidden=elNew("input",{type:"hidden",name:`${id}[name][${count}]`,value:name});field.appendChild(checkbox),field.appendChild(label),field.appendChild(hidden),dropfield2.find(".dropfield2_field.created")?dropfield2.find(".dropfield2_field.created").last().insert(field.outerHTML,"after"):dropfield2.find(".dropfield2_selecter").insert(field.outerHTML,"after"),_(checkbox).click(),self.next("input").val("").trigger("keyup")}})),_(document).on("keydown",".dropfield2_search input",(function(e){13===e.keyCode&&(e.preventDefault(),_(this).prev("a.create").click())})),_(document).on("click",".dropfield2_select_all a",(function(e){e.stopImmediatePropagation();const parent=_(this).closest(".dropfield2");doDropfieldRefresh=!1,parent.find("div.dropfield2_field:not(.hidden) > input:not(:checked):not(.disabled)").each((function(){this.checked=!0})),doDropfieldRefresh=!0,parent.prev(".dropfield").trigger("refresh"),_(this).text(LOCALE.deselectAll).parent().addClass("dropfield2_deselect_all").removeClass("dropfield2_select_all")})),_(document).on("click",".dropfield2_deselect_all a",(function(e){e.stopImmediatePropagation();const parent=_(this).closest(".dropfield2");doDropfieldRefresh=!1,parent.find("div.dropfield2_field:not(.hidden) > input:checked:not(.disabled)").each((function(){this.checked=!1})),doDropfieldRefresh=!0,parent.prev(".dropfield").trigger("refresh"),_(this).text(LOCALE.selectAll).parent().addClass("dropfield2_select_all").removeClass("dropfield2_deselect_all")})),_(document).on("click",".dropfield2",(function(e){e.stopImmediatePropagation()})),_(document).on("resize",".dropfield2",(function(e){e.stopImmediatePropagation()})),_(document).on("click",".dropfield",(function(e){const df=_(this),df2=df.next(".dropfield2");_(".dropfield.hovered").not(df)?.removeClass("hovered"),df.hasClass("hovered")?df.removeClass("hovered"):(df.addClass("hovered"),delay(500).then((()=>{const searchField=df2.find(".dropfield2_search > input");searchField&&searchField.trigger("focus")})))})),_(document).on("change keyup",'input[type="text"][maxlength], input[type="password"][maxlength]',(function(){const self=_(this);simpleValidate(self,self.val().length<=self.attr("maxlength"),LOCALE.maxLengthError)})).on("change keyup",'input[type="text"][minlength], input[type="password"][minlength]',(function(){const self=_(this);simpleValidate(self,self.val().length>=self.attr("minlength"),LOCALE.minLengthError)})).on("change keyup",'input[type="password"]',(function(){const self=_(this),passFieldName=convertName(self.attr("name"),0).replace(/2/g,"");passFieldName.length&&passFieldName!==convertName(self.attr("name"),0)&&simpleValidate(self,self.val()==_(`input[type="password"][name="${passFieldName}"]`).val(),LOCALE.passwordsDoesntMatch)})).on("change keyup",'input[type="text"][name^="em"]',(function(){const self=_(this);simpleValidate(self,/^([а-яёЁa-zA-Z0-9_.\-+])+@(([а-яёЁa-zA-Z0-9\-])+\.)+([а-яёЁa-zA-Z0-9]{2,4})+$/.test(self.val()),LOCALE.wrongEmailFormat)})).on("change",".inputtextarea",(function(){const self=_(this);validateTextMaxLength(self,self.attr("maxchar"))})).on("change",".inputnum",(function(){checkNumeric(_(this))})),_(document).on("click",".field",(function(e){const target=e.target;if("label"===target.tagName.toLowerCase())return!1;const name=convertName(_(this).attr("id"),6),selected=_(".fieldname.selected");let checkName=null;if(selected.asDomElement()&&selected.is("[id]")&&(checkName=convertName(selected.attr("id"),5)),checkName!==name){const df=_(`#selected_${name}`);_(".dropfield.hovered").not(df)?.removeClass("hovered"),selected.removeClass("selected"),showHelpAndName(name),el(`[name="${name}"]`)&&_(`[name="${name}"]`).focus(),df.asDomElement()&&!df.hasClass("hovered")&&df.click()}else _(`#help_${name}:not(.fixed_help)`).toggle();const checkboxSelector=`.inputcheckbox[name="${name}"]`;if(checkboxSelector&&"input"!==target.tagName.toLowerCase()&&(!target.type||"checkbox"!==target.type.toLowerCase())&&el(checkboxSelector)){const checkbox=_(checkboxSelector);checkbox.asDomElement().checked=!checkbox.asDomElement().checked,checkbox.trigger("change")}})),_(document).on("click","div.indexer_toggle",(function(){const self=_(this),indexer=_("div.indexer"),maincontentData=_("div.maincontent_data");indexer.toggle(),self.toggleClass("indexer_shown"),maincontentData.toggleClass("with_indexer")})),_(document).on("change",'select[name="searchAllTextFieldsValues"]',(function(){const self=_(this),textfield=_('input[name="searchAllTextFields"]');"search_empty"===self.val()||"search_non_empty"===self.val()?textfield.val("").disable():textfield.enable()})),_(document).on("click","[action_request]:not(.careful)",(function(e){e.preventDefault();const self=_(this);actionRequest({action:self.attr("action_request"),obj_id:self.attr("obj_id")},self)})),_(document).on("click","button.main",(function(e){e.preventDefault();const self=_(this);self.hasClass("fraymmodal-window")||(self.addClass("triggered"),self.closest("form")?.trigger("submit"))})),_(document).on("keydown",'input[type="text"], input[type="password"], select, textarea',(function(e){const self=_(this);if((e.ctrlKey||self.is("input"))&&13==e.keyCode){if(e.preventDefault(),self.next("button"))return void self.next("button").click();let parentDiv=self.parent();parentDiv.is(".td")?parentDiv=parentDiv.parent().next(".tr.menu"):parentDiv.next("button.main")?parentDiv=parentDiv.parent():parentDiv.find("button.main")||(parentDiv.parent().find("button.main")?parentDiv=parentDiv.parent():parentDiv.parent().parent().find("button.main")&&(parentDiv=parentDiv.parent().parent()));const button=parentDiv.find("button.main")?.first();button?.asDomElement()&&button.click()}})),_(document).on("click",".careful",(function(e){e.preventDefault(),e.stopImmediatePropagation();let customCarefulHandled=!1;if("function"==typeof customCarefulHandler&&(customCarefulHandled=customCarefulHandler(this)),!customCarefulHandled){const btn=_(this);fraymNotyPrompt(btn,null,(function(dialog){btn.is("[href]")?btn.hasClass("file_delete")?fetchData(btn.attr("href"),{json:!0,method:"DELETE"}).then((function(result){for(let key in result)_(`a[href$="${key}"]`).parent().remove();btn.is("[post_action]")&&btn.is("[post_action_id]")&&actionRequest({action:btn.attr("post_action"),obj_id:btn.attr("post_action_id")},btn)})):notyDeleteButton(btn):btn.is("[action_request]")?actionRequest({action:btn.attr("action_request"),obj_id:btn.attr("obj_id")},btn):btn.hasClass("main")&&btn.closest("form").trigger("submit"),dialog.close()}))}return!1})),_(document).on("click",".noty_modal",(function(){const notyDialogDom=getNotyDialogDOM();notyDialogDom.find(".btn.btn-danger")?notyDialogDom.find(".btn.btn-danger").click():notyDialog?.close()})),_(document).on("submit","form",(function(){const self=_(this);if("_blank"!==self.attr("target")&&!blockDefaultSubmit){const href=self.attr("action"),checkActionRequest=self.hasAttr("action_request_form"),noDynamicContent=self.hasAttr("no_dynamic_content");if(!doSubmit&&!checkActionRequest){let data;self.find("button.main")?.each((function(){_(this).disable().destroy(),appendLoader(this)}));const btnClicked=self.find("button.triggered");let method=self.attr("method")||"POST";if(fraymFileUploadInputsFix(),data=new FormData,null!==btnClicked&&btnClicked.closest("div.multi_objects_entity")&&!btnClicked.closest("form").hasAttr("no_dynamic_content")){let trs=[],btnTr=btnClicked.closest("div.tr");for(;btnTr?.prev()&&(btnTr=btnTr.prev(),!btnTr.hasClass("menu"));)trs.push(btnTr);trs.reverse();for(const tr of trs)tr.find('input:not([type="file"]), select, textarea').each((function(){const field=this;if(field.name){let value=field.value;field.matches('[type="checkbox"]')?value=field.checked?"on":null:field.matches('[type="radio"]')&&(value=field.checked?field.value:null),null!==value&&data.append(field.name,value)}}));const globalFormInputs=elAll(':scope > input[type="hidden"]',btnClicked.closest("form").asDomElement());_each(globalFormInputs,(input=>{data.append(input.getAttribute("name"),input.value)})),method=btnClicked.attr("method")||method}else _(this).find('input:not([type="file"]), select, textarea').each((function(){const field=this;if(field.name){let value=field.value;field.matches('[type="checkbox"]')?value=field.checked?"on":null:field.matches('[type="radio"]')&&(value=field.checked?field.value:null),null!==value&&data.append(field.name,value)}})),_each(elAll("div.wysiwyg-editor",this),(editor=>{const html=wysiwygObjs.get(editor.getAttribute("id")).root.innerHTML;data.append(editor.getAttribute("name"),"<p><br></p>"!==html?html:"")}));return btnClicked?.removeClass("triggered"),noDynamicContent||data.append("preRequestCheck","true"),fetchData(href,{method:method,json:!0},data).then((jsonData=>{if(doSubmit=!1,showMessagesFromJson(jsonData),void 0!==jsonData.redirect)if("stayhere"==jsonData.redirect)if(el(".fraymmodal-overlay.shown")){const hash=window.location.hash.substring(1),hashElement=el('[hash="'+hash+'"]');hashElement&&_(hashElement).click()}else updateState(currentHref);else"submit"==jsonData.redirect?(doSubmit=!0,updateState(href,"",this)):self.is("[no_dynamic_content]")?window.location=jsonData.redirect:el(".fraymmodal-overlay.shown")?(hrefAfterModalClose=jsonData.redirect,_(".fraymmodal-overlay.shown").click()):updateState(jsonData.redirect);else _(".red").removeClass("red"),void 0!==jsonData.fields&&_each(jsonData.fields,(data=>{isNumeric(data)?self.find(`#line${data}`).addClass("red"):_(`#name_${data=convertName(data,0)}`).addClass("red")})),void 0===jsonData.fields&&_(".timestamp").val(Math.round((new Date).getTime()/1e3)+10);self.find("button.main")?.each((function(){_(this).enable().destroy(),removeLoader(this)}))})).catch((error=>{showMessage({text:LOCALE.formSubmitError,type:"error",timeout:5e3}),console.error(error.message),self.find("button.main")?.each((function(){_(this).enable().destroy(),removeLoader(this)}))})),!1}return checkActionRequest?(doSubmit=!1,actionRequest({action:href+self.find('input[name="action"]').first().val(),dynamicForm:!0},self),!1):(doSubmit=!1,!0)}return!blockDefaultSubmit&&(this.submit(),!0)})),_(document).on("submit","form",(function(){_(this).find("input, textarea")?.each((function(){const self=_(this);self.val()===self.attr("placehold")&&self.val("")}))})),_(document).on("click",".fraymmodal-window",(function(e){e.preventDefault(),fraymModalApply(this)})),_(document).on("change keyup",".helper",(function(e){if("change"===e.type&&"input"===this.tagName.toLowerCase())return!1;const self=_(this),val=self.val(),url=`${self.attr("action")}input=${val}`,target=_(`[name="${self.attr("target")}"]`);return target.disable(),target.empty(),!isNumeric(val)&&val.length<3?(target.insert(`<option>${LOCALE.typeAtLeast3Symbols}</option>`,"begin"),!1):(target.insert(`<option>${LOCALE.searchOngoing}</option>`,"begin"),fetchData(url,{method:"GET",json:!0}).then((jsonData=>{target.empty();let addedOptions=!1;_each(jsonData,(value=>{void 0!==value.id&&void 0!==value.value&&(target.insert(`<option value="${value.id}">${value.value}</option>`,"end"),addedOptions=!0)})),addedOptions?(target.insert(`<option value="">${LOCALE.dropFieldChooseFromFound}</option>`,"begin"),target.find("option")?.asDomElements()[1].setAttribute("selected",!0),target.enable()):target.insert(`<option>${LOCALE.nothingFound}</option>`,"begin")})),!0)})),_(document).on("keydown",(function(e){if(9==(e.keyCode||e.which)){e.stopImmediatePropagation(),e.preventDefault();let tabIndex=1;const selected=el(".fieldname.selected")?_(el(".fieldname.selected")):null,focused=_(document.activeElement);selected?(tabIndex=+selected.attr("tabIndex")+1,self=selected):focused&&(tabIndex=focused.parent().is("[tabIndex]")?+focused.parent().attr("tabIndex")+1:+focused.attr("tabIndex")+1,self=focused);let next=_('[tabIndex="'+tabIndex+'"]');if(next.is("div.fieldname"))next.focus().click();else if(next.is("div.td")){let firstChild=_(next.asDomElement().firstChild);firstChild?firstChild.focus().click():next.focus().click()}else next.focus()}})),_(document.body).observerDOMChange((()=>{_(".menu a:not(.mouseEventsAdded)").each((function(){this.classList.add("mouseEventsAdded"),this.addEventListener("mouseenter",(function(){const self=_(this);self.hasClass("arrowAppended")||(self.hasClass("arrow_up")||self.hasClass("arrow_down")?self.hasClass("arrowChanged")||(self.addClass("arrowChanged"),self.toggleClass("arrow_up").toggleClass("arrow_down")):(self.addClass("arrowAppended"),self.addClass("arrow_down")))})),this.addEventListener("mouseleave",(function(){const self=_(this);self.hasClass("arrowAppended")?(self.removeClass("arrowAppended"),self.removeClass("arrow_down")):self.hasClass("arrowChanged")&&(self.removeClass("arrowChanged"),self.toggleClass("arrow_up").toggleClass("arrow_down"))}))}))})),_(document).on("keyup",'div.multi_objects_table.cards div.td input[name^="name"]',(function(){const self=_(this);self.closest("div.tr")?.find("span.cardtable_card_num_name")?.text(self.val())})),_(document).on("touchstart",(function(){touchingDevice=!0})).on("wheel mousedown",(function(){_("body").addClass("no_outline")})).on("resize scroll wheel touchmove",(function(){_(".help:not(.fixed_help)").hide(),_("div.helper").hide()})).on("scroll",(function(){fixateIndexerButtons()})).on("touchstart",(function(e){touchstartX=e.changedTouches[0].screenX,touchstartY=e.changedTouches[0].screenY,swipeTimeDiff=Date.now()})).on("touchend",(function(e){const changedTouch=e.changedTouches[0];touchendX=changedTouch.screenX,touchendY=changedTouch.screenY,handleSwipe(document.elementFromPoint(changedTouch.clientX,changedTouch.clientY))})).on("click",(function(e){e.target.closest(".field")||e.target.closest(".filtersBlock")||e.target.closest(".td")||(_(".help:not(.fixed_help)").hide(),_(".fieldname").removeClass("selected"),_(".dropfield.hovered").removeClass("hovered")),_(".closeOnDocumentClick").each((function(){e.target.closest(".closeOnDocumentClick")!==this&&e.target.closest(".shown")?.previousElementSibling!==this&&_(this).trigger("close")}))}));const sbiSelector=".sbi:not(.loading):not(.loaded)",elements=elAll(sbiSelector);elements.length&&elements.forEach((el=>loadSbiBackground(el)));const sbiObserver=new MutationObserver((mutations=>{mutations.forEach((mutation=>{mutation.addedNodes.forEach((node=>{1===node.nodeType&&(node.matches(sbiSelector)&&loadSbiBackground(node),elAll(sbiSelector,node).forEach((el=>loadSbiBackground(el))))}))}))}));sbiObserver.observe(document.body,{childList:!0,subtree:!0}),showExecutionTime("Document events end")}if(fixSvgWithoutViewBox(),_('select[name="searchAllTextFieldsValues"]').trigger("change"),""!==window.location.hash&&(withDocumentEvents||popStateChanging||updateHash)){const hash=window.location.hash.substring(1),element=el(`.fraymmodal-window[hash="${hash}"]`);if(element){const fraymTabs=_(element).closest(".fraymtabs");fraymTabs?.asDomElement()?ifDataLoaded("fraymTabsApply","fraymModalSwitchTabByHash",element,(function(){delay().then((()=>{const panel=_(element).closest(".fraymtabs-panel");panel?.asDomElement()&&_(`a#${panel.attr("id").replace("fraymtabs-","")}`).parent().trigger("click"),fraymModalApply(element)}))})):(window.location.hash="",fraymModalApply(element))}}mobilecheck()&&ifDataLoaded("fraymTabsApply","fraymScrollToTab",el(".fraymtabs"),(function(){this&&delay().then((()=>{const selectedTab=el(":scope > ul > .fraymtabs-active",this);selectedTab&&(el(":scope > ul",this).scrollLeft=selectedTab.offsetLeft)}))})),showMessages(),showExecutionTime("fraymInit end"),"function"==typeof projectInit?await projectInit(withDocumentEvents,updateHash):await loadJsCssForCMSVC()}function ready(fn){try{(document.attachEvent?"complete"===document.readyState:"loading"!==document.readyState)?fn():document.addEventListener("DOMContentLoaded",fn)}catch(e){console.log(e)}}function showExecutionTime(message){if(showTimeMode){message=defaultFor(message,"Execution time");const execTime=(new Date).getTime()-startTime;console.log(`${message}: ${execTime}`),startTime=(new Date).getTime()}}function defaultFor(arg,val){return void 0!==arg&&""!==arg&&null!==arg?arg:val}function convertName(str,char){return void 0!==str&&(str=(str=(str=str.substring(char)).replace(/\[/g,"\\[")).replace(/]/g,"\\]")),str}function clearBraces(str){return str=(str=str.replace("{","")).replace("}","")}function objectToArray(data){return data=Array.from(data,(value=>value))}function normalizeToArray(elements){if(void 0===elements)return[];if("string"==typeof elements)elements=elAll(elements)||[];else if(Array.isArray(elements)||elements instanceof NodeList);else if(elements instanceof HTMLCollection){const collection=elements;elements=[];for(let i=0;i<collection.length;i++)elements.push(collection[i])}else elements=[elements];let results=[];try{_each(elements,(elem=>results=results.concat(domElementFromAnything(elem))))}catch(e){console.error(e),console.error(elements)}return results}ready((()=>{"pushState"in history?(history.replaceState({href:document.location.href,replacedDiv:"div.maincontent_data"},document.title,document.location.href),_(document).on("click",`[href^="/"], [href*="${document.location.protocol}//${document.location.hostname}"]`,(function(e){if(!popStateChanging){let self=_(this);self.hasClass("no_dynamic_content")||self.hasClass("fraymmodal-window")||self.hasClass("careful")||"blank"===self.attr("target")||"_blank"===self.attr("target")||filesDirProtect.test(self.attr("href"))?"_blank"===self.attr("target")?(e.preventDefault(),window.open(self.attr("href"))):!self.is("button")||self.hasClass("fraymmodal-window")||self.hasClass("careful")||(e.preventDefault(),"_blank"===self.attr("target")?window.open(self.attr("href")):window.location=self.attr("href")):(e.preventDefault(),updateState(self.attr("href")))}})),_(document).on("click",`button[href]:not(.careful):not(.fraymmodal-window):not([href^="/"]):not([href*="${document.location.protocol}//${document.location.hostname}"])`,(function(e){e.preventDefault();let self=_(this);"_blank"===self.attr("target")?window.open(self.attr("href")):window.location=self.attr("href")})),window.onpopstate=function(e){e.state&&(popStateChanging=!0,e.preventDefault(),updateState(e.state.href,e.state.replacedDiv))}):_(document).on("click","button[href]:not(.careful):not(.fraymmodal-window)",(function(e){e.preventDefault();const self=_(this);"_blank"===self.attr("target")?window.open(self.attr("href")):window.location=self.attr("href")}));const localeUrls=elAll(".localeUrl");let localeLoadedCounter=0;if(0===localeUrls.length)postLocalesLoad();else for(let item of localeUrls)fetchData(item.href,{method:"GET",json:!0}).then((localeData=>{LOCALE=Object.assign(LOCALE,localeData),localeLoadedCounter++,localeLoadedCounter===localeUrls.length&&postLocalesLoad()}));function postLocalesLoad(){fraymInit(!0)}})),String.prototype.br2nl=function(){return this.replace(/<br\s*\/?>/gi,"\n")},String.prototype.nl2br=function(){return this.replace(/\n/g,"<br />")},String.prototype.nl2space=function(){return this.replace(/\n/g," ")};const el=(sel,parent)=>(parent||document).querySelector(sel),elAll=(sel,parent)=>(parent||document).querySelectorAll(sel),elNew=(tag,props)=>Object.assign(document.createElement(tag),props),elFromHTML=html=>{const template=document.createElement("template");return template.innerHTML=html.trim(),template.content.childElementCount>1?template.content.children:template.content.firstChild},domElementFromAnything=element=>element?.nodeType?element:"string"==typeof element||element instanceof String?el(element.toString()):element instanceof FraymElement?element.asDomElement():element,_each=(collection,callback)=>{Array.isArray(collection)||collection instanceof Map?collection.forEach(callback):collection instanceof Object&&null!==collection?Object.entries(collection).forEach((([key,value])=>callback(value,key,collection))):(console.trace(),console.warn("Unsupported collection type for _each."),console.log(collection))},_arSuccess=(callbackName,callback)=>{actionRequestCallbacks.success[callbackName]=callback},_arError=(callbackName,callback)=>{actionRequestCallbacks.error[callbackName]=callback};function _(element,options){let fraymElement;return element?(element instanceof String&&(element=element.toString()),options?options.noCache?fraymElement=new FraymElement(element):(fraymElement=new FraymElement(element,options),fraymElementsMap.set(fraymElement.asDomElement(),fraymElement)):(fraymElement=fraymElementsMap.get(element),fraymElement?fraymElement.DOMElements=normalizeToArray(element):(fraymElement=new FraymElement(element),fraymElementsMap.set(element,fraymElement))),fraymElement):null}class FraymElement{constructor(element,options){this.DOMElements=[],this.observer=null,this.onDOMChange=[],this.element=element;try{this.DOMElements=options?[elNew(this.element,options)]:normalizeToArray(this.element)}catch(e){console.error(e)}}destroy(){const fraymElement=this;return activeListeners.get(fraymElement)&&activeListeners.delete(fraymElement),fraymElementsMap.delete(this.element),this}first(){return _(this.DOMElements[0])}asDomElement(){return this.DOMElements[0]||null}asDomElements(){return this.DOMElements}children(){return _(this.asDomElement().children)}last(){return _(this.DOMElements.at(-1))}eq(index,asDomElement){return asDomElement?this.DOMElements[index]||null:_(this.DOMElements[index])}each(functionData){return _each(this.DOMElements,(elem=>functionData.call(elem))),this}trigger(event){return this.each((function(){this.dispatchEvent(new CustomEvent(event,{bubbles:!0}))})),this}focus(){return this.asDomElement()?.focus(),this}click(){return this.trigger("click"),this}change(){return this.trigger("change"),this}submit(){return this.trigger("submit"),this}checked(checked){return this.each((function(){this.checked=checked})),this}remove(){return this.each((function(){this.remove()})),this}empty(){const element=this.asDomElement();for(;element?.firstChild;)element.firstChild.remove();return this}find(selector,returnAsDomElements,containsText,notContainsText){returnAsDomElements=defaultFor(returnAsDomElements,!1);let preResults=[];this.each((function(){preResults=preResults.concat(elAll(selector,this))}));let results=[];try{_each(preResults,(nodeList=>{_each(nodeList,(function(elem){containsText&&!elem.textContent.toLowerCase().includes(containsText.toLowerCase())||notContainsText&&elem.textContent.toLowerCase().includes(notContainsText.toLowerCase())||(results=results.concat(elem))}))}))}catch(e){console.error(e),console.error(preResults)}return 0===results.length?null:returnAsDomElements?results:_(results)}closest(selector){const closest=this.asDomElement()?.closest(selector);return closest?_(closest):null}parent(){const parent=this.asDomElement()?.parentElement;return parent?_(parent):null}prev(selector,untilSelector){const currentElement=this.asDomElement();let foundPreviousSibling=null,foundPreviousSiblings=[];if(currentElement){let prevSibling=currentElement.previousElementSibling;if(selector)for(;prevSibling;){if(untilSelector&&prevSibling.matches(untilSelector))return _(foundPreviousSiblings);if(prevSibling.matches(selector)){if(!untilSelector){foundPreviousSibling=prevSibling;break}foundPreviousSiblings.push(prevSibling)}prevSibling=prevSibling.previousElementSibling}else foundPreviousSibling=prevSibling}return untilSelector?_(foundPreviousSiblings):foundPreviousSibling?_(foundPreviousSibling):null}next(selector,untilSelector){const currentElement=this.asDomElement();let foundNextSibling=null,foundNextSiblings=[];if(currentElement){let nextSibling=currentElement.nextElementSibling;if(selector)for(;nextSibling;){if(untilSelector&&nextSibling.matches(untilSelector))return _(foundNextSiblings);if(nextSibling.matches(selector)){if(!untilSelector){foundNextSibling=nextSibling;break}foundNextSiblings.push(nextSibling)}nextSibling=nextSibling.nextElementSibling}else foundNextSibling=nextSibling}return untilSelector?_(foundNextSiblings):foundNextSibling?_(foundNextSibling):null}not(selectorOrElement){let results=[];return _each(this.asDomElements(),(element=>{"string"!=typeof selectorOrElement||element.matches(selectorOrElement)?selectorOrElement instanceof FraymElement&&element!==selectorOrElement.asDomElement()&&results.push(element):results.push(element)})),0===results.length?null:_(results)}css(ruleName,value){if(void 0!==value)return this.each((function(){this.style[ruleName]=value})),this;const self=this.asDomElement();return self?getComputedStyle(self)[ruleName]:null}outerHeight(value){return void 0!==value?this.css("height",`${value}px`):this.asDomElement()?.offsetHeight}outerWidth(value){return void 0!==value?this.css("width",`${value}px`):this.asDomElement()?.offsetWidth}attr(name,value){if(void 0!==value)return null===value?this.each((function(){this.removeAttribute(name)})):this.each((function(){this.setAttribute(name,value)})),this;{const self=this.asDomElement();return self?self.getAttribute(name):null}}hasAttr(name){const self=this.asDomElement();return!!self&&self.hasAttribute(name)}is(selector){const self=this.asDomElement();return!!self&&(":visible"===selector?self.offsetWidth>0&&self.offsetHeight>0:self.matches(selector))}index(){const self=this.asDomElement();return self?[...self.parentNode.children].indexOf(self):null}hasClass(className){const self=this.asDomElement();return!!self&&self.classList.contains(className)}addClass(className){return this.each((function(){this.classList.add(className)})),this}removeClass(className){return this.each((function(){this.classList.remove(className)})),this}toggleClass(className,addClass){return this.each((function(){!0===addClass?this.classList.add(className):!1===addClass?this.classList.remove(className):this.classList.toggle(className)})),this}show(){return this.each((function(){_(this).addClass("shown").removeClass("hidden")})),this}hide(){return this.each((function(){_(this).removeClass("shown").addClass("hidden")})),this}toggle(show){return this.each((function(){const self=_(this);!0===show?self.show():!1===show||self.is(":visible")?self.hide():self.show()})),this}enable(){return this.each((function(){_(this).attr("disabled",null)})),this}disable(){return this.each((function(){_(this).attr("disabled","true")})),this}val(value){if(void 0!==value)return this.each((function(){this.value=value})),this;{const self=this.asDomElement();return self?self.options&&self.multiple?[...self.options].filter((option=>option.selected)).map((option=>option.value)):self.value:null}}text(value){return void 0!==value?(this.each((function(){this.textContent=value})),this):this.asDomElement()?.textContent}html(value){return void 0!==value?(this.each((function(){this.innerHTML=value})),this):this.asDomElement()?.innerHTML}on(listeners,elementSelectorOrHandler,handler){if(void 0===globalFraymListenersObserver&&(globalFraymListenersObserver=new MutationObserver((mutations=>{if(0!==activeListeners.size)for(const mutation of mutations)for(const node of mutation.addedNodes)1===node.nodeType&&_each(activeListeners,(fraymElementListeners=>{_each(fraymElementListeners,((handlerHashesData,elementDOMName)=>{_each(handlerHashesData,(data=>{_each(data.listeners,(listener=>{node.matches(elementDOMName)&&node.addEventListener(listener,data.handler),elAll(elementDOMName,node).forEach((child=>child.addEventListener(listener,data.handler)))}))}))}))}))})),globalFraymListenersObserver.observe(document.body,{childList:!0,subtree:!0})),void 0!==listeners){void 0===handler&&(handler=elementSelectorOrHandler,elementSelectorOrHandler=null);const element=this.element,elementDOMName=element===document||"string"==typeof element?`${element===document?"":element}${elementSelectorOrHandler?(element===document?"":" ")+elementSelectorOrHandler:""}`:null,handlerHash=hashCode(listeners+elementDOMName+handler.toString());if("object"!=typeof element||elementSelectorOrHandler){activeListeners.get(this)||activeListeners.set(this,{});const elementInActiveListenersMap=activeListeners.get(this);void 0===elementInActiveListenersMap[elementDOMName]&&(elementInActiveListenersMap[elementDOMName]={});const elementDOMNameHandlerMap=elementInActiveListenersMap[elementDOMName];void 0===elementDOMNameHandlerMap[handlerHash]&&(elementDOMNameHandlerMap[handlerHash]={handler:handler,listeners:[]});const handlerDataInHandlersMap=elementDOMNameHandlerMap[handlerHash];_each(listeners.split(" "),(listener=>{if(!handlerDataInHandlersMap.listeners.includes(listener)){const elements=elAll(elementDOMName);elements.length&&elements.forEach((el=>el.addEventListener(listener,handler))),handlerDataInHandlersMap.listeners.push(listener)}}))}else _each(listeners.split(" "),(listener=>{_each(this.DOMElements,(elem=>elem.addEventListener(listener,handler)))}))}return this}objectToFormData(){const formData=new FormData;return _each(this.DOMElements,((value,key)=>{formData.append(key,value)})),formData}isElementInViewport(callback){return this.observer=new window.IntersectionObserver((([entry])=>{entry.isIntersecting&&callback()}),{root:null,threshold:0}),_each(this.DOMElements,(elem=>{try{this.observer.observe(elem)}catch(e){console.log(e)}})),this}observerDOMChange(callback){const self=this.asDomElement();if(self){_each(this.onDOMChange,(savedCallback=>{if(savedCallback===callback)return this})),this.onDOMChange.push(callback);const observer=new MutationObserver((mutationsList=>{for(const mutation of mutationsList)"childList"===mutation.type&&_each(this.onDOMChange,(callback=>callback()))}));observer.observe(self,{childList:!0,subtree:!0})}return this}insert(htmlOrElement,position){return this.each((function(){if("string"==typeof htmlOrElement){const positions={before:"beforebegin",after:"afterend",begin:"afterbegin",end:"beforeend",prepend:"afterbegin",append:"beforeend"};this.insertAdjacentHTML(positions[position]||position,htmlOrElement)}else htmlOrElement=domElementFromAnything(htmlOrElement),"before"===position?this.before(htmlOrElement):"after"===position?this.after(htmlOrElement):"begin"===position||"prepend"===position?this.prepend(htmlOrElement):"end"!==position&&"append"!==position||this.append(htmlOrElement)})),this}offset(){const self=this.asDomElement();if(!self)return null;const box=self.getBoundingClientRect(),docElem=document.documentElement;return{top:box.top+window.pageYOffset-docElem.clientTop,left:box.left+window.pageXOffset-docElem.clientLeft}}position(){const self=this.asDomElement();if(!self)return null;const{top:top,left:left}=self.getBoundingClientRect(),{marginTop:marginTop,marginLeft:marginLeft}=getComputedStyle(self);return{top:top-parseInt(marginTop,10),left:left-parseInt(marginLeft,10)}}animate(name,value){return"scrollLeft"===name?this.scrollLeft(value):"scrollTop"===name&&this.scrollTop(value),this}scrollLeft(left){return this.each((function(){this.scroll({left:left,behavior:"smooth"})})),this}scrollTop(top){return this.each((function(){this.scroll({top:top,behavior:"smooth"})})),this}}function scrollWindow(height){_(window,{noCache:!0}).scrollTop(height).destroy()}function mobilecheck(){let check=!1;var a;return a=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series([46])0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br([ev])w|bumb|bw-([nu])|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do([cp])o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly([-_])|g1 u|g560|gene|gf-5|g-mo|go(.w|od)|gr(ad|un)|haie|hcit|hd-([mpt])|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c([- _agpst])|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac([ -\/])|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja([tv])a|jbro|jemu|jigs|kddi|keji|kgt([ \/])|klon|kpt |kwc-|kyo([ck])|le(no|xi)|lg( g|\/([klu])|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t([- ov])|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30([02])|n50([025])|n7(0([01])|10)|ne(([cm])-|on|tf|wf|wg|wt)|nok([6i])|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan([adt])|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c([-01])|47|mc|nd|ri)|sgh-|shar|sie([-m])|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel([im])|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c([- ])|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(a.substring(0,4))||touchingDevice)&&(check=!0),check}function getOrCreateDeviceId(){let id=localStorage.getItem("deviceId");return id||(id=crypto.randomUUID(),localStorage.setItem("deviceId",id)),id}function hashCode(s){let i,l,char,hash=0;if(0==(s=String(s)).length)return hash;for(i=0,l=s.length;i<l;i++)char=s.charCodeAt(i),hash=(hash<<5)-hash+char,hash|=0;return hash}function delay(ms){return ms=defaultFor(ms,200),new Promise((resolve=>setTimeout(resolve,ms)))}function debounce(id,func,delay){_debounceTimers[id]&&clearTimeout(_debounceTimers[id]),_debounceTimers[id]=setTimeout((()=>{func(),delete _debounceTimers[id]}),delay)}function getCursorPosition(element){const input=domElementFromAnything(element);if(!input)return 0;if("selectionStart"in input)return input.selectionStart;if(document.selection){input.focus();const sel=document.selection.createRange(),selLen=document.selection.createRange().text.length;return sel.moveStart("character",-input.value.length),sel.text.length-selLen}return 0}function autoLayoutKeyboard(str){const replacer={q:"й",w:"ц",e:"у",r:"к",t:"е",y:"н",u:"г",i:"ш",o:"щ",p:"з","[":"х","]":"ъ",a:"ф",s:"ы",d:"в",f:"а",g:"п",h:"р",j:"о",k:"л",l:"д",";":"ж","'":"э",z:"я",x:"ч",c:"с",v:"м",b:"и",n:"т",m:"ь",",":"б",".":"ю","/":"."};return str.replace(/[A-z/,.;']/g,(function(x){return x==x.toLowerCase()?replacer[x]:replacer[x.toLowerCase()].toUpperCase()}))}function getExtension(file_name){return file_name.substr(file_name.lastIndexOf(".")+1)}function absolutePath(){return"https://"+window.location.hostname}function parseUri(str){const o={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};let m=o.parser[o.strictMode?"strict":"loose"].exec(str),uri={},i=14;for(;i--;)uri[o.key[i]]=m[i]||"";return uri[o.q.name]={},uri[o.key[12]].replace(o.q.parser,(function($0,$1,$2){$1&&(uri[o.q.name][$1]=$2)})),uri}function isNumeric(num){return"number"==typeof num?num-num==0:"string"==typeof num&&""!==num.trim()&&Number.isFinite(+num)}function isInt(num){return!isNaN(num)&&(0|(x=parseFloat(num)))===x;var x}function removeInvalidChars(field){field.value=field.value.replace(new RegExp(["\ud83c[\udf00-\udfff]","\ud83d[\udc00-\ude4f]","\ud83d[\ude80-\udeff]"].join("|"),"g"),"")}function loadSbiBackground(sbi){const imgURL=window.getComputedStyle(sbi).getPropertyValue("background-image")?.replace("url(","").replace(")","").replace(/"/gi,""),classList=[...sbi.classList].map((cls=>`.${cls}`)).join("")+":not(.loading):not(.loaded)";if(!sbi.classList.contains("loading")&&!sbi.classList.contains("loaded")&&void 0!==imgURL&&"none"!==imgURL){const allSvgParents=_(classList,{noCache:!0});allSvgParents.addClass("loading"),fetchData(imgURL,{method:"GET"}).then((function(data){if(allSvgParents.asDomElement()){const svg=_(elFromHTML(data),{noCache:!0});svg.attr("xmlns:a",null).attr("preserveAspectRatio","xMidYMid meet").attr("width","100%").attr("height","100%"),svg.attr("viewBox")||svg.attr("viewBox","0 0 100% 100%");const svgHtml=svg.asDomElement().outerHTML;svg.destroy(),allSvgParents.each((function(){const svgHolder=_(this,{noCache:!0});svgHolder.insert(svgHtml,"end"),svgHolder.asDomElement().style.backgroundImage="none",svgHolder.removeClass("loading").addClass("loaded"),svgHolder.destroy()}))}allSvgParents.destroy()}))}}function fixSvgWithoutViewBox(){el("svg:not([viewBox])")&&_("svg:not([viewBox])").each((function(){const self=_(this);self.attr("width")&&self.attr("height")&&this.setAttribute("viewBox",`0 0 ${self.attr("width").replace("px","")} ${self.attr("height").replace("px","")}`),self.destroy()})).destroy()}function getLocale(){return LOCALE.localeCode}function submenuToggle(button,submenu){_(button).on("click close",(function(e){e.stopImmediatePropagation(),_(button).toggleClass("opened").toggleClass("closeOnDocumentClick"),_(submenu).toggle()})),_(submenu+" a").on("click",(function(){_(this).hasClass("no_dynamic_content")||_(button).is(":visible")&&(_(button).removeClass("opened").removeClass("closeOnDocumentClick"),_(submenu).hide())}))}const showHideByValue=function(selector,value){const element=_(selector,{noCache:!0});value>0?element.show().text(value):element.hide().text(""),element.destroy()};function handleSwipe(elem){if(elem){let check=_(elem);for(;check.parent()?.asDomElement();){if("auto"==check.css("overflow-x"))return!1;if(check=check.parent(),check.parent()?.asDomElement()instanceof HTMLElement)break}let index=-1;if(Date.now()-swipeTimeDiff<swipeTimeThreshold&&Math.abs(touchendX-touchstartX)>Math.abs(touchendY-touchstartY)&&Math.abs(touchendX-touchstartX)>swipeDiffThreshold){const self=_("body div.fraymtabs").first(),navPanel=self.find(":scope > ul"),controls=navPanel.find(":scope > li"),control=navPanel.find(":scope > .fraymtabs-active");if(touchendX>touchstartX?self.asDomElement()&&(index=control.index(),index>0?index--:index=-1):touchendX<touchstartX&&self.asDomElement()&&(index=control.index(),index<self.find(":scope > ul li").DOMElements.length-1?index++:index=-1),index>-1&&(touchendX<touchstartX||touchendX>touchstartX)){const selectedControl=controls.eq(index),offsetLeft=selectedControl.asDomElement().offsetLeft;navPanel.animate("scrollLeft",offsetLeft),delay().then((()=>{const anchor=selectedControl.find("a[id]"),ahref=selectedControl.find("a[href]");ahref.asDomElement()?updateState(ahref.attr("href")):anchor.asDomElement()&&selectedControl.click()}))}}}}function updateState(newHref,replacedDiv,form){replacedDiv=defaultFor(replacedDiv,"div.maincontent_data");const currentHrefParsed=parseUri(currentHref),newHrefParsed=parseUri(newHref);if("index.php"!==newHrefParsed.file){if(popStateChanging&&currentHrefParsed.path===newHrefParsed.path)currentHrefParsed.anchor!==newHrefParsed.anchor?(""===newHrefParsed.anchor&&el(`li.fraymtabs-active a#${currentHrefParsed.anchor}`)?_(`li.fraymtabs-active a#${currentHrefParsed.anchor}`).closest("ul")?.find("a")?.first().click():""===newHrefParsed.anchor&&el(".fraymmodal-overlay.shown")?_(".fraymmodal-overlay.shown").click():""!=newHrefParsed.anchor?el(`#${newHrefParsed.anchor}`)?_(`#${newHrefParsed.anchor}`).click():el(`[hash="${newHrefParsed.anchor}"]`)?_(`[hash="${newHrefParsed.anchor}"]`).click():"function"==typeof customHashHandler&&customHashHandler(newHrefParsed):"function"==typeof customHashHandler&&customHashHandler(newHrefParsed),currentHref=newHref):(console.error("popStateChanging, но хэш не изменился"),console.trace());else if("pushState"in history){let link=document.location.protocol+"//"+document.location.hostname+newHrefParsed.path+(/\/$/.test(newHrefParsed.path)&&newHrefParsed.query?"?"+newHrefParsed.query+"&":"")+(""!=newHrefParsed.anchor?"#"+newHrefParsed.anchor:""),data=null;if(doSubmit){if(link=document.location.protocol+"//"+document.location.hostname+newHrefParsed.path+(""!=newHrefParsed.anchor?"#"+newHrefParsed.anchor:""),form||(form=el(`form[action="${newHref}"]`)),form.hasAttribute("no_dynamic_content"))return form.submit(),!1;data=new FormData(form)}el("div.fullpage_cover")&&(_("div.fullpage_cover").show().destroy(),"function"==typeof customUpdateState&&customUpdateState(newHrefParsed)),showExecutionTime("updateState before request"),fetchData(link,{method:doSubmit?"POST":"GET",json:!0},data).then((result=>{if(showExecutionTime("updateState beginning of success"),showMessagesFromJson(result),void 0!==result.redirect&&""!==result.redirect)return updateState(result.redirect,replacedDiv),!1;if(currentHref=newHref,popStateChanging||currentHrefParsed.path===newHrefParsed.path&&currentHrefParsed.anchor===newHrefParsed.anchor||history.pushState({href:newHref,replacedDiv:replacedDiv},result.pageTitle,newHref),showExecutionTime("updateState history.pushState"),document.title=result.pageTitle,el('meta[property="og:title"]')&&_('meta[property="og:title"]').attr("content",result.pageTitle),el('meta[property="og:url"]')&&_('meta[property="og:url"]').attr("content",newHref),_("div.indexer").remove(),showExecutionTime("updateState indexer and doubles removed"),el(replacedDiv)){_(replacedDiv).first().insert('<div id="replacedDivSpot" />',"before");const parentElem=el(replacedDiv).parentNode,replacedElems=elAll(`:scope > ${replacedDiv}`,parentElem);_each(replacedElems,(replacedElem=>{parentElem.removeChild(replacedElem)})),showExecutionTime("updateState old content removed"),_("#replacedDivSpot").insert(result.html,"before").remove(),showExecutionTime("updateState new content inserted");const scripts=_(replacedDiv).asDomElement()?.getElementsByTagName("script");if(scripts)for(let ix=0;ix<scripts.length;ix++)eval(scripts[ix].text);showExecutionTime("updateState scripts in new content executed")}else window.location=newHref;fraymInit(!1,!0).then((()=>(showExecutionTime("updateState pre additional actions"),""===newHrefParsed.anchor&&el(".fraymmodal-overlay.shown")&&_(".fraymmodal-overlay.shown").click(),popStateChanging=!1,el("div.fullpage_cover")&&(_("div.fullpage_cover").hide().destroy(),"function"==typeof customUpdateState&&customUpdateState(newHrefParsed,!0)),scrollWindow(0),showExecutionTime("updateState additional actions"),!0)))})).catch((error=>{popStateChanging=!1,el("div.fullpage_cover")&&(_("div.fullpage_cover").hide().destroy(),"function"==typeof customUpdateState&&customUpdateState(newHrefParsed,!0)),showMessage({text:LOCALE.switchPageError,type:"error",timeout:5e3}),console.error(error.message),console.error(error.stack)}))}else currentHrefParsed.path===newHrefParsed.path&&currentHrefParsed.anchor!==newHrefParsed.anchor?window.location.hash=newHrefParsed.anchor:(currentHref=newHref,window.location=newHref);doSubmit=!1}return!0}function componentsUpdateState(new_anchor){if("pushState"in history)if(popStateChanging)popStateChanging=!1;else{if(parseUri(currentHref).anchor!==new_anchor){const hrefParsed=parseUri(document.location.href),link=document.location.protocol+"//"+document.location.hostname+hrefParsed.path+(""!=new_anchor?"#":"")+new_anchor;history.pushState({href:link,replacedDiv:"div.maincontent_data"},document.title,link),currentHref=link}hrefAfterModalClose?(updateState(hrefAfterModalClose),hrefAfterModalClose=null):fraymInit(!1)}else window.location.hash=new_anchor}async function fetchData(url,options={},data=null){if(checkHttpUrl(url)){options.json=defaultFor(options.json,!1),options.method=defaultFor(options.method,"POST");let requestOptions,headers={"Fraym-Request":!0};jwtToken&&(headers.Authorization="Bearer "+jwtToken),"POST"===options.method||"PUT"===options.method?(data=new URLSearchParams(data),requestOptions={method:options.method,headers:headers,body:data}):requestOptions={method:options.method,headers:headers};const response=await fetch(url,requestOptions);return response.ok?options.json?await response.json():await response.text():new Response(null,{status:0,statusText:"NetworkError"})}return new Response(null,{status:0,statusText:"NetworkError"})}function dataElementLoad(dataName,element,loadingFunction,loadedFunction,options,dataElementCategory){void 0!==dataName&&void 0!==element&&void 0!==loadingFunction&&void 0!==loadedFunction&&(dataElementCategory=defaultFor(dataElementCategory,"libraries"),void 0===dataLoaded[dataElementCategory][dataName]&&(dataLoaded[dataElementCategory][dataName]=!1,loadingFunction.call()),!1===dataLoaded[dataElementCategory][dataName]?delay(50).then((()=>{dataElementLoad(dataName,element,loadingFunction,loadedFunction,options,dataElementCategory)})):!0===dataLoaded[dataElementCategory][dataName]&&loadedFunction.call(element,options))}function verifyDataLoaded(dataCategory,dataName,functionName){const intervalId=setInterval((function(){dataLoaded[dataCategory][dataName]&&(dataLoaded.functions[functionName]=!0,clearInterval(intervalId))}),50);delay(5e3).then((()=>{clearInterval(intervalId)}))}function ifDataLoaded(dataName,functionName,element,callback,dataCategory){dataCategory=defaultFor(dataCategory,"libraries"),dataElementLoad(functionName,element,(()=>{verifyDataLoaded(dataCategory,dataName,functionName)}),callback,{},"functions")}window.fetch=new Proxy(window.fetch,{async apply(fetch,thisArg,args){let[url,options={}]=args;options.headers=options.headers||{};let response;(function(url){try{const u=new URL("string"==typeof url?url:url.url,location.href);return u.href!==REFRESH_URL&&u.origin===location.origin}catch{return!1}})&&(jwtToken||options.headers.Authorization||(jwtTokenRefreshing||(jwtTokenRefreshing=fetch(jwtTokenRefreshUrl,{method:"GET"}).then((r=>r.text())).then((token=>{jwtToken=token})).finally((()=>{jwtTokenRefreshing=null}))),await jwtTokenRefreshing.catch((()=>{}))),jwtToken&&(options.headers.Authorization="Bearer "+jwtToken));try{response=await fetch.apply(thisArg,[url,options])}catch{return new Response(null,{status:0,statusText:"NetworkError"})}return response}});const getScript=url=>new Promise(((resolve,reject)=>{const script=document.createElement("script");script.src=url,script.async=!0,script.onerror=reject,script.onload=script.onreadystatechange=function(){const loadState=this.readyState;loadState&&"loaded"!==loadState&&"complete"!==loadState||(script.onload=script.onreadystatechange=null,resolve())},document.head.appendChild(script)})),cssLoad=(name,url)=>new Promise(((resolve,reject)=>{if(dataLoaded.css[name]||el(`link[href="${url}"]`))resolve();else{const link=document.createElement("link");link.rel="stylesheet",link.type="text/css",link.href=url,link.onload=()=>{dataLoaded.css[name]=!0,resolve()},link.onerror=reject,document.head.appendChild(link)}})),loadJsCssForCMSVC=cmsvc=>new Promise(((resolve,reject)=>{if(!cmsvc){const currentHrefParsed=parseUri(currentHref);currentHrefParsed.path.split("/").length>2&&(cmsvc=currentHrefParsed.path.split("/")[1]),cmsvc=defaultFor(cmsvc,"start")}cssLoad(cmsvc,`/vendor/fraym/cmsvc/${cmsvc}.css`).then((()=>{!1!==dataLoaded.js[cmsvc]?void 0===dataLoaded.js[cmsvc]?getScript(`/vendor/fraym/cmsvc/${cmsvc}.js`).then((()=>{dataLoaded.js[cmsvc](!0),resolve()})).catch((function(){dataLoaded.js[cmsvc]=!1,resolve()})):(dataLoaded.js[cmsvc](!1),resolve()):resolve()}))})),loadJsComponent=component=>new Promise(((resolve,reject)=>{component||resolve(),!1!==dataLoaded.libraries[component]?void 0===dataLoaded.libraries[component]?getScript(`/vendor/fraym/cmsvc/${component}.js?component=1`).then((()=>{dataLoaded.libraries[component](!0),resolve()})).catch((function(){dataLoaded.libraries[component]=!1,resolve()})):(dataLoaded.libraries[component](!1),resolve()):resolve()}));function preload(arrayOfImages){_each(arrayOfImages,(image=>{if(-1==preloadedImages.indexOf(image)){(new Image).src=image,preloadedImages.push(image)}}))}function actionRequest(params,target){const paramsAction=params.action,n=paramsAction.lastIndexOf("/");params.action=paramsAction.substring(n+1),params.kind=paramsAction.substring("/"==paramsAction.substring(0,1)?1:0,n);const url=`${absolutePath()}/${params.kind}/action=${params.action}`;let data;params.dynamicForm&&target?(target.find("button.main")?.each((function(){_(this,{noCache:!0}).disable().destroy(),appendLoader(this)})),target.find('input[type="text"], textarea')?.each((function(){removeInvalidChars(this)})),fraymFileUploadInputsFix(),data=new FormData(domElementFromAnything(target))):data=params;let headers={};""!=jwtToken&&(headers.Authorization="Bearer "+jwtToken),fetchData(url,{method:"POST",headers:headers,json:!0},data).then((function(jsonData){el("div.fullpage_cover")&&_("div.fullpage_cover",{noCache:!0}).hide().destroy(),"success"===jsonData.response?actionRequestCallbacks.success[params.action](jsonData,params,target):(!actionRequestSupressErrorForActions.includes(params.action)&&navigator.onLine&&showMessageFromJsonData(jsonData),actionRequestCallbacks.error[params.action](jsonData,params,target))})).catch((function(error){el("div.fullpage_cover")&&_("div.fullpage_cover",{noCache:!0}).hide().destroy(),console.error(error.message),console.error(error.stack),!actionRequestSupressErrorForActions.includes(params.action)&&navigator.onLine&&showMessage({text:LOCALE.dynamicRequestError,type:"error",timeout:5e3}),actionRequestCallbacks.error[params.action](null,params,target,error)})),params.dynamicForm&&target&&target.find("button.main")?.each((function(){_(this,{noCache:!0}).enable().destroy(),removeLoader(this)}))}function simpleValidate(self,condition,title){""===self.val()?self.removeClass("ok").removeClass("attention_red").closest(".fieldvalue")?.attr("data-tooltip-text",null):condition?self.addClass("ok").removeClass("attention_red").closest(".fieldvalue")?.attr("data-tooltip-text",null):self.removeClass("ok").addClass("attention_red").closest(".fieldvalue")?.attr("data-tooltip-text",title)}function checkNumeric(self){if(self.val()){const t=parseFloat(self.val());isNaN(t)&&(self.val("0"),showMessage({text:LOCALE.onlyNumbersAreAllowed,type:"error",timeout:5e3}))}}function validateTextMaxLength(field,maxlimit){const val=field.val();maxlimit&&val.length>maxlimit&&(field.val(val.substring(0,maxlimit)),showMessage({text:LOCALE.maxLengthError2+" "+maxlimit+".",type:"error",timeout:5e3}))}function checkHttpUrl(string){if(!string)return!1;if(string.startsWith("/"))return!0;let givenURL;try{givenURL=new URL(string)}catch(error){return!1}return"http:"===givenURL.protocol||"https:"===givenURL.protocol}function validateEmail(email=""){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(email.trim())}function showHelpAndName(nameOrElement,parentElement){_(".help:not(.fixed_help)").hide();const isName="string"==typeof nameOrElement,helpDiv=isName?el(`.help#help_${nameOrElement}`):domElementFromAnything(nameOrElement);parentElement=defaultFor(parentElement,isName?el(`#field_${nameOrElement}`):null);const nameDiv=isName?el(`#name_${nameOrElement}`):null;helpDiv&&(_(helpDiv).show(),helpDiv.style.marginTop=-Math.floor(helpDiv.getBoundingClientRect().height)+"px",parentElement&&(helpDiv.style.width=`${parentElement.offsetWidth}px`)),nameDiv&&_(nameDiv).addClass("selected")}function fixateIndexerButtons(){if(el("div.indexer")){const element=_("div.indexer div.filtersBlock").last(),indexerElementBottom=element.position().top+element.asDomElement().offsetHeight-window.innerHeight;_("div.indexer").hasClass("shown")&&document.body.scrollTop<indexerElementBottom?_("div.indexer button").addClass("floaty"):_("div.indexer button").removeClass("floaty")}}function appendLoader(element){if(element=domElementFromAnything(element),!el("#circleG",element)){const circleG=elNew("div",{id:"circleG"});for(let i=1;i<=3;i++){const circle=elNew("div",{id:`circleG_${i} `,classList:"circleG"});circleG.appendChild(circle)}element.prepend(circleG),element.classList.add("loader_appended")}}function removeLoader(element){element=domElementFromAnything(element);const loader=el("#circleG",element);loader&&loader.remove(),element.classList.remove("loader_appended")}function fraymPlaceholder(field){if(void 0!==field&&(field=_(domElementFromAnything(field))).is("[placehold]")){const placehold=field.attr("placehold");/msie/.test(navigator.userAgent.toLowerCase())?(""===field.val()&&(field.val(placehold),field.addClass("placeholded")),field.on("keydown",(function(){const self=_(this);self.val()===placehold&&(self.val(""),self.removeClass("placeholded"))})),field.on("blur",(function(){const self=_(this);""!==self.val()&&self.val()!==placehold||(self.val(placehold),self.addClass("placeholded"))}))):field.attr("placeholder",field.attr("placehold"))}}function filterDropfield(el,string){if(el instanceof FraymElement){const container=el.closest(".dropfield2"),createLink=el.prev(".create");if(string==LOCALE.dropFieldSearchAdd||""===string)container.find(".dropfield2_field")?.show(),container.find(".dropfield2_field[pl]")?.each((function(){const self=_(this);self.attr("pl")&&(self.asDomElement().style.paddingLeft=`${self.attr("pl")}px`,self.attr("pl",null))})),createLink?.hide();else{let alreadyShownIds=[];container.find(".dropfield2_field")?.hide(),container.find(".dropfield2_field",!1,string)?.each((function(){const self=_(this);alreadyShownIds.includes(self.attr("id"))||(alreadyShownIds.push(self.attr("id")),self.attr("pl",self.asDomElement().style.paddingLeft),self.show().asDomElement().style.paddingLeft="0px")})),createLink?.show()}container.find("div.dropfield2_field:not(.hidden) > input:not(:checked):not(.disabled)")?container.find(".dropfield2_selecter > a")?.text(LOCALE.selectAll).parent().addClass("dropfield2_select_all").removeClass("dropfield2_deselect_all"):container.find(".dropfield2_selecter > a")?.text(LOCALE.deselectAll).parent().addClass("dropfield2_deselect_all").removeClass("dropfield2_select_all")}}function toggleDynamicFields(self){const selfType="SELECT"===self.asDomElement().tagName?"select":"multiselect",selfName=self.attr("name");_each(currentDynamicFieldsList,(function(item){let selfAffectsElem=!1,hideElem=!0;if(_each(item.dependencies,(function(dependencyItems){let foundFullGroup=!0;_each(dependencyItems,(function(dependencyItem){("select"==selfType&&"select"==dependencyItem.type&&dependencyItem.name==selfName||"multiselect"==selfType&&"multiselect"==dependencyItem.type&&`${dependencyItem.name}[${dependencyItem.value}]`==selfName||"multiselect"==selfType&&"multiselect"==dependencyItem.type&&dependencyItem.name==selfName)&&(selfAffectsElem=!0),("select"==dependencyItem.type&&_(`select[name="${dependencyItem.name}"]`).val()!=dependencyItem.value||"multiselect"==dependencyItem.type&&(el(`input[type="checkbox"][name="${dependencyItem.name}[${dependencyItem.value}]"]`)&&!_(`input[type="checkbox"][name="${dependencyItem.name}[${dependencyItem.value}]"]`).is(":checked")||el(`input[type="radio"][name="${dependencyItem.name}"]`)&&_(`input[type="radio"][name="${dependencyItem.name}"]:checked`).val()!=dependencyItem.value))&&(foundFullGroup=!1)})),foundFullGroup&&(hideElem=!1)})),selfAffectsElem){let domElem=el(`div.field[id^="field_${item.name}"]`);if(domElem||(domElem=el(item.name)),hideElem&&domElem){const elem=_(domElem);elem.hide(),elem.find('input[type="text"], select, textarea')?.val("").trigger("change"),doDropfieldRefresh=!1,elem.find("input:checked:not(:disabled)")?.each((function(){_(this,{noCache:!0}).checked(!1).change().destroy()})),doDropfieldRefresh=!0,_(`[id="selected_${item.name}"]`).trigger("refresh")}else{self.closest("div.field").asDomElement().after(domElem),_(domElem).show().trigger("change")}}}))}function initDynamicFields(){dynamicFieldsList.length>0?(currentDynamicFieldsList=dynamicFieldsList,_each(currentDynamicFieldsList.reverse(),(function(item){_each(item.dependencies,(function(dependencyItems){_each(dependencyItems,(function(dependencyItem){let curName="";"select"==dependencyItem.type?curName=`select[name="${dependencyItem.name}"]`:"multiselect"==dependencyItem.type&&(curName=el(`input[type="radio"][name="${dependencyItem.name}"]`)?`input[name="${dependencyItem.name}"]`:`input[name="${dependencyItem.name}[${dependencyItem.value}]"]`),_(curName).on("change",(function(){currentDynamicFieldsList.length&&toggleDynamicFields(_(this))})),_(curName).trigger("change")}))}))}))):currentDynamicFieldsList=[],dynamicFieldsList=[]}function dateFromLogicTimepicker(dateFromField){const dateFromFieldValue=new Date(dateFromField.value),dateToField=el('input.dpkr_time[name="date_to[0]"]');let dateToFieldValue=new Date(dateToField.value);dateToFieldValue<dateFromFieldValue&&(dateToFieldValue=dateFromFieldValue,dateToFieldValue.setHours(dateToFieldValue.getHours()+1),dateToField.value=dateFormat(dateToFieldValue,!0));const repeatUntil=el('input.dpkr[name="repeat_until[0]"]');if(repeatUntil){let repeatUntilValue=new Date(repeatUntil.value);repeatUntilValue<dateFromFieldValue&&(repeatUntilValue=dateFromFieldValue,repeatUntilValue.setHours(repeatUntilValue.getHours()+1),repeatUntil.value=dateFormat(repeatUntilValue,!0))}}function dateFromLogic(dateFromField){const dateFromFieldValue=new Date(dateFromField.value),dateToField=el('input.dpkr[name="date_to[0]"]');new Date(dateToField.value)<dateFromFieldValue&&(dateToField.value=dateFormat(dateFromFieldValue))}function dateToLogicTimepicker(dateToField){const dateFromField=el('input.dpkr_time[name="date_from[0]"]'),dateFromFieldValue=new Date(dateFromField.value);dateToField.min=dateFormat(dateFromFieldValue,!0),dateToField.value<dateToField.min&&(dateToField.value=dateToField.min)}function dateToLogic(dateToField){const dateFromField=el('input.dpkr[name="date_from[0]"]'),dateFromFieldValue=new Date(dateFromField.value);dateToField.min=dateFormat(dateFromFieldValue),dateToField.value<dateToField.min&&(dateToField.value=dateToField.min)}function dateFormat(date,withTime){withTime=defaultFor(withTime,!1);let local=new Date(date);return local.setMinutes(date.getMinutes()-date.getTimezoneOffset()),local.toJSON().slice(0,withTime?16:10)}function dateFormatText(date,withTime,locale){return locale=defaultFor(locale,"ru-RU"),withTime?date.toLocaleDateString(locale,{dateStyle:"short"})+" "+date.toLocaleTimeString(locale,{timeStyle:"short"}):date.toLocaleDateString(locale)}function dateFromString(str){const date=str.substring(0,10),time=str.substring(11,16),dateFrom=date.split("."),timeFrom=time.split(":");return new Date(parseInt(dateFrom[2]),parseInt(dateFrom[1])-1,parseInt(dateFrom[0]),parseInt(timeFrom[0]),parseInt(timeFrom[1]))}function formatMoney(amount,currency="USD",locale=navigator.language){return new Intl.NumberFormat(locale,{style:"currency",currency:currency}).format(amount)}function formatDate(dateString,locale=navigator.language){const date=new Date(dateString);return new Intl.DateTimeFormat(locale,{day:"numeric",month:"long",year:"numeric"}).format(date)}function fraymDateTimePickerApply(){_(document).on("change",'input.dpkr_time[name="date_from[0]"]',(function(){dateFromLogicTimepicker(this)})).on("change",'input.dpkr[name="date_from[0]"]',(function(){dateFromLogic(this)})).on("change",'input.dpkr_time[name="date_to[0]"]',(function(){dateToLogicTimepicker(this)})).on("change",'input.dpkr[name="date_to[0]"]',(function(){dateToLogic(this)})),_('input.dpkr_time[name="date_to[0]"]').each((function(){dateToLogicTimepicker(this)})),_('input.dpkr[name="date_to[0]"]').each((function(){dateToLogic(this)}))}function fraymFileBrowseStylerApply(element){dataElementLoad("fraymFileBrowseStylerApply",element,(()=>{getScript("/vendor/fraym/js/styler/styler.min.js").then((()=>{dataLoaded.libraries.fraymFileBrowseStylerApply=!0}))}),(function(){const self=domElementFromAnything(this);_(self).hasClass("fraymStylerApplied")||(new FraymStyler(self,{filePlaceholder:LOCALE.file.filePlaceholder,fileBrowse:LOCALE.file.fileBrowse,fileNumber:LOCALE.file.fileNumber}),fraymFileUploadApply(self))}))}function fraymFileUploadApply(element){dataElementLoad("fraymFileUploadApply",element,(()=>{cssLoad("fraymFilepond","/vendor/fraym/js/filepond/filepond.min.css"),getScript("/vendor/fraym/js/filepond/filepond.min.js").then((()=>{getScript(`/vendor/fraym/js/filepond/locale/${getLocale()}.min.js`).then((()=>{FilePond.setOptions(FilePondLocale),window.isLoadingCheck=function(filepondObj){const isLoading=0!==filepondObj.getFiles().filter((x=>5!==x.status&&2!==x.status&&8!==x.status)).length,form=_(`input[name="${filepondObj.name}"]`).closest("form");isLoading?form.find("button.main").disable():form.find("button.main").enable()},dataLoaded.libraries.fraymFileUploadApply=!0}))}))}),(function(){const self=domElementFromAnything(this);if(self){const obj=_(self);if(!obj.hasClass("filePondApplied")){obj.addClass("filePondApplied");const uploadPath=obj.attr("data-upload-path"),uploadNum=obj.attr("data-upload-num"),uploadName=obj.attr("data-upload-name"),previouslyUploadedFiles=JSON.parse(obj.attr("data-uploaded-files"))||[];let previouslyUploadedFilesDecoded=[];_each(previouslyUploadedFiles,(function(file){previouslyUploadedFilesDecoded.push({source:uploadPath+file.path,options:{type:"local",metadata:{name:file.name,nameShown:file.name_shown}}})}));const filepondObj=FilePond.create(self,{allowMultiple:obj.hasAttr("multiple"),maxFiles:null,files:previouslyUploadedFilesDecoded,server:{process:(fieldName,file,metadata,load,error,progress,abort,transfer,options)=>{const formData=new FormData;formData.append(obj.hasAttr("multiple")?fieldName.substring(0,fieldName.length-2):fieldName,file,file.name);const request=new XMLHttpRequest;return request.open("POST",`${uploadPath}?type=${uploadNum}`),request.upload.onprogress=e=>{progress(e.lengthComputable,e.loaded,e.total)},request.onload=function(){if(request.status>=200&&request.status<300){const response=JSON.parse(request.responseText),errorText=response[uploadName][0].error;void 0!==errorText?(showMessage({text:errorText,type:"error"}),error(errorText)):load(response[uploadName][0].name)}else error(request.statusText)},request.send(formData),{abort:()=>{request.abort(),abort()}}},revert:(uniqueFileId,load)=>{fetchData(`${uploadPath}?type=${uploadNum}&${uploadName}=${uniqueFileId}`,{method:"DELETE"}).then((()=>{load()}))},load:(uniqueFileId,load,error,progress,abort,headers)=>(fetch(uniqueFileId).then((response=>{if(!response.ok)throw new Error("Failed to load file");progress(!0,0,1),response.blob().then((function(myBlob){let name=response.headers.get("content-disposition").match(/"([^"]+)"/);myBlob.name=name[1],load(myBlob)}))})).catch((err=>{error(err.message)})),{abort:()=>{abort()}}),restore:null,fetch:null},onaddfilestart:()=>{isLoadingCheck(filepondObj)},onprocessfile:()=>{isLoadingCheck(filepondObj)},onaddfile:()=>{isLoadingCheck(filepondObj)}});filepondObjs.set(obj.attr("name"),filepondObj)}}}))}function fraymFileUploadInputsFix(){_each(filepondObjs,(filepondObj=>{const filepondFiles=filepondObj.getFiles(),inputs=_(`input[type="hidden"][name="${filepondObj.name}"]`);_each(filepondFiles,((file,key)=>{const value=`{${file.filename}:${file.getMetadata("name")||file.serverId}}`,input=inputs.DOMElements[key];input.classList.contains("filepondNameConverted")||(input.value=value,input.classList.add("filepondNameConverted"))}))}))}function fraymWysiwygApply(element){dataElementLoad("fraymWysiwygApply",element,(()=>{cssLoad("fraymQuill","/vendor/fraym/js/quill/quill.snow.min.css"),getScript("/vendor/fraym/js/quill/quill.min.js").then((()=>{dataLoaded.libraries.fraymWysiwygApply=!0,Quill.import("ui/icons").viewCode='<span class="ql-custom-text"><></span>'}))}),(function(options){const obj=_(domElementFromAnything(this));obj.hasClass("quillApplied")||(wysiwygObjs.set(obj.attr("id"),new Quill(obj.asDomElement(),options)),obj.addClass("quillApplied"),obj.asDomElement().insertAdjacentHTML("beforeBegin",`<textarea class="${obj.hasClass("obligatory")?"obligatory":""}" id="fraym_${obj.attr("id")}" data-wysiwyg-id="${obj.attr("id")}"></textarea>`))}),{debug:!1,modules:{toolbar:{container:[["bold","italic","underline","strike",{script:"sub"},{script:"super"}],[{align:[]}],["link","image"],[{list:"ordered"},{list:"bullet"}],[{indent:"-1"},{indent:"+1"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],["clean"],[{viewCode:!0}]],handlers:{image:function(){const range=this.quill.getSelection();let imageUrl=prompt(LOCALE.wysiwyg.inputImageUrl);imageUrl&&this.quill.insertEmbed(range.index,"image",imageUrl,Quill.sources.USER)},viewCode:function(){const quillContainer=_(this.quill.container),textarea=quillContainer.prev("textarea");quillContainer.hasClass("hidden")?(this.quill.clipboard.dangerouslyPasteHTML(textarea.val()),quillContainer.show(),textarea.hide(),this.quill.focus()):(textarea.val(this.quill.root.innerHTML),quillContainer.hide(),textarea.show(),textarea.asDomElement().focus())}}}},theme:"snow"})}function fraymModalApply(element){const options={savedHash:parseUri(currentHref).anchor,onOpen:element=>{componentsUpdateState(element.attr("hash"))},onClose:()=>{componentsUpdateState(options.savedHash)}};dataElementLoad("fraymModalApply",element,(()=>{getScript("/vendor/fraym/js/modal/modal.min.js").then((()=>{dataLoaded.libraries.fraymModalApply=!0}))}),(function(){const self=domElementFromAnything(this);new FraymModal(self,options)}),options)}function fraymTabsApply(element){dataElementLoad("fraymTabsApply",element,(()=>{getScript("/vendor/fraym/js/tabs/tabs.min.js").then((()=>{dataLoaded.libraries.fraymTabsApply=!0}))}),(function(){const self=domElementFromAnything(this);new FraymTabs(self)}))}function fraymNotyInit(){dataElementLoad("fraymNotyInit",document,(()=>{getScript("/vendor/fraym/js/noty/noty.min.js").then((()=>{dataLoaded.libraries.fraymNotyInit=!0}))}),(function(){Noty.overrideDefaults({layout:"bottomLeft",theme:"fraym",closeWith:["click"]})}))}function fraymNotyPrompt(button,text,callback,callbackCancel){ifDataLoaded("fraymNotyInit","fraymNotyPrompt",document,(function(){notyDialog?.close(),callbackCancel=defaultFor(callbackCancel,(function(){notyDialog?.close()}));let okText=LOCALE.yes,cancelText=LOCALE.cancelCapitalized;button?(text=defaultFor(text,defaultFor(button.attr("text"),LOCALE.areYouSure)),okText=defaultFor(button.attr("ok_text"),okText),cancelText=defaultFor(button.attr("cancel_text"),cancelText)):text=defaultFor(text,LOCALE.areYouSure),notyDialog=new Noty({text:text,modal:!0,layout:"center",buttons:[Noty.button(okText,"btn btn-primary",callback),Noty.button(cancelText,"btn btn-danger",callbackCancel)]}),notyDialog.on("afterClose",(function(){notyDialog=null})),notyDialog.show()}))}function notyDeleteButton(button,params){ifDataLoaded("fraymNotyInit","notyDeleteButton",document,(function(){const href=defaultFor(button.attr("href"),null),method=defaultFor(button.attr("method"),"GET");if(params=defaultFor(params,""),href){button.is("button")&&(button.disable(),appendLoader(button));fetchData(href+params,{json:!0,method:method}).then((function(jsonData){void 0!==jsonData.redirect?"stayhere"===jsonData.redirect?updateState(currentHref):el(".fraymmodal-overlay.shown")?(hrefAfterModalClose=jsonData.redirect,_(".fraymmodal-overlay.shown").click()):button.hasClass("no_dynamic_content")?window.location=jsonData.redirect:updateState(jsonData.redirect):(void 0!==jsonData.messages&&_each(jsonData.messages,(data=>{"success_delete"!==data[0]?showMessage({text:data[1],type:data[0]}):_(`div.tr[obj_id="${data[1]}"]`).trigger("remove").remove()})),button.is("button")&&(button.enable(),removeLoader(button)))}))}}))}function createPseudoPrompt(html,title,additionalButtons,onClose,onShow){ifDataLoaded("fraymNotyInit","createPseudoPrompt",document,(function(){notyDialog?.close();let buttons=[];_each(additionalButtons,(function(buttonData){const button=Noty.button(buttonData.text,`btn btn-primary ${buttonData.class}`,buttonData.click);buttons.push(button)})),buttons.push(Noty.button(LOCALE.closeCapitalized,"btn btn-danger",(function(){notyDialog?.close()}))),notyDialog=new Noty({text:title+html,modal:!0,layout:"center",buttons:buttons,closeWith:["button"]}),onClose&&notyDialog.on("onClose",onClose),onShow&&notyDialog.on("onShow",onShow),notyDialog.on("afterClose",(function(){notyDialog=null})),notyDialog.show()}))}function getNotyDialogDOM(){const dom=notyDialog?.layoutDom;return dom?_(dom):null}function showMessage(options){let timeout=options.timeout||25*options.text.length;timeout<5e3&&(timeout=5e3),ifDataLoaded("fraymNotyInit","showMessage",document,(function(){new Noty({text:options.text,type:options.type,timeout:timeout}).show()}))}function showMessages(){for(let message of messages)showMessage({text:message[1],type:message[0]});messages=[]}function showMessagesFromJson(jsonData){void 0!==jsonData.messages&&(_each(jsonData.messages,(data=>{messages.push(data)})),showMessages())}function showMessageFromJsonData(jsonData){showMessage({text:jsonData.response_text,type:jsonData.response,timeout:5e3})}function fraymAutocompleteApply(element,options){dataElementLoad("fraymAutocompleteApply",element,(()=>{cssLoad("fraymAutocomplete","/vendor/fraym/js/autocomplete/autocomplete.min.css"),getScript("/vendor/fraym/js/autocomplete/autocomplete.min.js").then((()=>{dataLoaded.libraries.fraymAutocompleteApply=!0}))}),(function(){const self=domElementFromAnything(this);new FraymAutocomplete(self,options)}),options)}function fraymDragDropApply(element,options){dataElementLoad("fraymDragDropApply",element,(()=>{getScript("/vendor/fraym/js/dragdrop/dragdrop.min.js").then((()=>{dataLoaded.libraries.fraymDragDropApply=!0}))}),(function(){if("string"==typeof this||this instanceof String)new FraymDragDrop(this.toString(),options);else{const self=domElementFromAnything(this);new FraymDragDrop(self,options)}}),options)}